<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ExpenserMon: Manage your finances with style. Track expenses, set goals, and monitor progress in a fun, practical way.">
  <meta name="keywords" content="expense tracker, financial management, budgeting app, personal finance">
  <title>ExpenserMon - Professional Financial Management</title>
  
  <!-- CSS é carregado externamente -->
  <link rel="stylesheet" href="styleExpenses.css"> 
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Chart.js for pie chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Plugin do Chart.js para mostrar porcentagens/labels -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  
  <!-- NENHUM CSS INLINE -->
</head>
<body>

  <button class="dark-mode-toggle" id="darkModeToggle"><i class="fas fa-moon"></i></button>

  <div class="background"></div>
  <div id="google_translate_element"></div>


  <nav class="navbar">
    <div class="logo-container">
      <span class="logo">ExpenserMon</span>
    </div>
    <div class="user-info">
      <!-- Adicionado elemento para mostrar nome do usuário carregado pelo profile -->
      <span id="usernameDisplay">User</span>
    </div>
    <ul class="nav-links">
      <li><a href="#dashboard" class="active">Dashboard</a></li>
      <li><a href="#reports">Reports</a></li>
      <li><a href="#goals">Goals</a></li>
      <li><a href="profile.html">Profile</a></li>
      <li><a href="Login.html">Logout</a></li>
    </ul>
    <div class="hamburger" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </nav>

  <section id="dashboard" class="dashboard">
    <h2>Your Financial Dashboard</h2>
    <div class="summary">
      <div class="card">
        <i class="fas fa-arrow-up stat-icon"></i>
        <h3>Total Income</h3>
        <p id="total-income">$0.00</p>
      </div>
      <div class="card">
        <i class="fas fa-arrow-down stat-icon"></i>
        <h3>Total Expenses</h3>
        <p id="total-expenses">$0.00</p>
      </div>
      <div class="card">
        <i class="fas fa-balance-scale stat-icon"></i>
        <h3>Net Balance</h3>
        <p id="net-balance">$0.00</p>
      </div>
      <div class="card budget-card">
        <i class="fas fa-bullseye stat-icon"></i>
        <h3>Monthly Budget</h3>
        <div class="budget-input-wrapper">
          <span class="currency-prefix">$</span>
          <input type="number" id="budget-input" class="editable-value" placeholder="0.00" min="0" step="0.01">
        </div>
        <!-- Adicionado id 'save-btn' para corresponder ao script -->
        <button id="save-btn" class="save-btn" onclick="saveBudget()">Save Budget</button>
        <div id="budget-status" class="budget-status hidden"></div>
      </div>
    </div>

    <div class="add-transaction">
      <h2>Add New Transaction</h2>
      <form id="transaction-form">
        <select id="type" required>
          <option value="">Select Type</option>
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
        <select id="category" required>
          <option value="">Select Category</option>
          <option value="Food">Food</option>
          <option value="Transport">Transport</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Utilities">Utilities</option>
          <option value="Health">Health</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" id="description" placeholder="Description" required>
        <div class="amount-wrapper">
          <select id="currency">
            <option value="$">$</option>
            <option value="€">€</option>
            <option value="£">£</option>
            <option value="R$">R$</option>
          </select>
          <input type="number" id="amount" placeholder="Amount" min="0" step="0.01" required>
        </div>
        <input type="date" id="date" required>
        <button type="submit">Add Transaction</button>
      </form>
    </div>

    <div class="transactions">
      <h2>Recent Transactions</h2>
      <div class="filter-section">
        <label for="filter-type">Filter by Type:</label>
        <select id="filter-type">
          <option value="">All</option>
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
        <label for="filter-category">Filter by Category:</label>
        <select id="filter-category">
          <option value="">All</option>
          <option value="Food">Food</option>
          <option value="Transport">Transport</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Utilities">Utilities</option>
          <option value="Health">Health</option>
          <option value="Other">Other</option>
        </select>
        <button class="export-btn" onclick="exportToCSV()">Export to CSV</button>
        <button class="clear-all-btn" onclick="deleteAllTransactions()">Clear All</button>
      </div>
      <table id="transactions-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Category</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="transactions-body">
          <!-- Transactions will be added here dynamically -->
        </tbody>
      </table>
      <div class="loading" id="loading">Loading transactions...</div>
    </div>
  </section>

  <section id="reports" class="reports">
    <h2>Financial Reports</h2>
    <div class="report-grid">
      <div class="report-card">
        <h3>Expense Breakdown</h3>
        <canvas id="expenseChart"></canvas>
      </div>
      <div class="report-card">
        <h3>Monthly Summary</h3>
        <p id="monthly-summary">No data available yet.</p>
      </div>
      <div class="report-card">
        <h3>Financial Tips</h3>
        <ul class="tips-list">
          <li>Track your expenses daily to stay on budget.</li>
          <li>Set realistic savings goals.</li>
          <li>Review your transactions monthly.</li>
          <li>Avoid impulse purchases.</li>
          <li>Use credit cards wisely to build credit.</li>
          <li>Automate savings transfers.</li>
        </ul>
      </div>
    </div>
  </section>

  <section id="goals" class="goals">
    <h2>Financial Goals</h2>
    <div class="goals-container">
      <div class="goal-card">
        <h3>Savings Goal</h3>
        <input type="number" id="savings-goal" placeholder="Target Amount" min="0" step="0.01">
        <button onclick="setSavingsGoal()">Set Goal</button>
        <div class="progress-bar">
          <div class="progress-fill" id="savings-progress"></div>
        </div>
        <p id="savings-status">Progress: 0%</p>
      </div>
      <div class="goal-card">
        <h3>Debt Reduction Goal</h3>
        <input type="number" id="debt-goal" placeholder="Target Amount" min="0" step="0.01">
        <button onclick="setDebtGoal()">Set Goal</button>
        <div class="progress-bar">
          <div class="progress-fill" id="debt-progress"></div>
        </div>
        <p id="debt-status">Progress: 0%</p>
      </div>
      <div class="goal-card">
        <h3>Emergency Fund</h3>
        <input type="number" id="emergency-goal" placeholder="Target Amount" min="0" step="0.01">
        <button onclick="setEmergencyGoal()">Set Goal</button>
        <div class="progress-bar">
          <div class="progress-fill" id="emergency-progress"></div>
        </div>
        <p id="emergency-status">Progress: 0%</p>
      </div>
    </div>
  </section>

  <footer>
    <div class="footer-content">
      <p>&copy; 2025 ExpenserMon. All rights reserved.</p>
      <ul class="footer-links">
        <li><a href="#">Privacy Policy</a></li>
        <li><a href="#">Terms of Service</a></li>
        <li><a href="#dashboard">Contact Us</a></li>
      </ul>
      <p>Contact: support@expensermon.com | +1 (555) 123-4567</p>
    </div>
  </footer>

  <!-- Custom Alert for notifications -->
  <div class="custom-alert-overlay" id="custom-alert">
    <div class="custom-alert-card">
      <h2 id="alert-title">Success!</h2>
      <p id="alert-message">Transaction added successfully.</p>
      <button class="btn-alert-close" onclick="closeAlert()">OK</button>
    </div>
  </div>

 <!-- SCRIPTS -->

 <!-- Google Translate (Scripts Corrigidos) -->
 <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en', 
        includedLanguages: 'en,pt', 
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
        autoDisplay: false
      }, 'google_translate_element');
    }
 </script>
 <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>


 <!-- Lógica Principal da Aplicação (Atualizada para API) -->
  <script>
    /* * * * SCRIPT DO DASHBOARD (CONECTADO À API) * * * */
    
    // URLs da API (Assumindo que ambas as APIs estão no mesmo servidor)
    const API_BASE_URL = 'http://localhost:8080';
    const API_TRACKERS_URL = `${API_BASE_URL}/trackers`;
    const API_AUTH_URL = `${API_BASE_URL}/api`; // Para /profile e /budget
    
    // Email do usuário logado (puxado do login)
    const USER_EMAIL = localStorage.getItem("userEmail");

    // Elementos do DOM
    const bg = document.querySelector('.background');
    const navLinks = document.querySelector('.nav-links');
    const transactionForm = document.getElementById('transaction-form');
    const transactionsBody = document.getElementById('transactions-body');
    const totalIncomeEl = document.getElementById('total-income');
    const totalExpensesEl = document.getElementById('total-expenses');
    const netBalanceEl = document.getElementById('net-balance');
    const budgetInput = document.getElementById('budget-input');
    const budgetStatusEl = document.getElementById('budget-status');
    const currencyPrefix = document.querySelector('.currency-prefix');
    const saveBudgetBtn = document.getElementById('save-btn');

    // Variáveis de estado global
    let transactions = []; // Lista local, sincronizada com o DB
    let budget = 0;
    let savingsGoal = parseFloat(localStorage.getItem('savingsGoal')) || 0;
    let debtGoal = parseFloat(localStorage.getItem('debtGoal')) || 0;
    let emergencyGoal = parseFloat(localStorage.getItem('emergencyGoal')) || 0;
    let expenseChart;

    // Registrar o plugin de datalabels globalmente
    Chart.register(ChartDataLabels);

    // --- CARREGAMENTO INICIAL ---
    document.addEventListener('DOMContentLoaded', () => {
        if (!USER_EMAIL) {
            showAlert("Login Required", "Redirecting to login page...", 'error');
            setTimeout(() => window.location.href = "Login.html", 1200);
            return;
        }
      loadInitialData();
      loadGoals(); // (Metas ainda usam localStorage por enquanto)

      // handlers UI
      document.getElementById('filter-type').addEventListener('change', renderTransactions);
      document.getElementById('filter-category').addEventListener('change', renderTransactions);

      // dark mode toggle
      const darkToggle = document.getElementById('darkModeToggle');
      darkToggle.addEventListener('click', toggleDarkMode);

      // hamburger
      const hamburger = document.getElementById('hamburger');
      hamburger.addEventListener('click', toggleMenu);
    });

    async function loadInitialData() {
        try {
            // 1. Buscar dados do perfil (Nome, Budget, Totais)
            const profileRes = await fetch(`${API_AUTH_URL}/profile/${USER_EMAIL}`);
            if (!profileRes.ok) throw new Error('Failed to load profile data');
            const user = await profileRes.json();
            document.getElementById('usernameDisplay').textContent = user.name || USER_EMAIL || "User";
            budget = parseFloat(user.budget) || 0;
            budgetInput.value = budget.toFixed(2);
            
            // 2. Buscar transações (do Controller /trackers)
            const transRes = await fetch(`${API_TRACKERS_URL}/${USER_EMAIL}`);
            if (!transRes.ok) throw new Error('Failed to load transactions');
            transactions = await transRes.json();

            // 3. Renderizar tudo
            renderTransactions();
            updateSummary(); // Calcula totais a partir da lista 'transactions'
            renderChart();
            updateBudgetStatus();
            updateGoalsProgress();

        } catch (error) {
            console.error("Error loading initial data:", error);
            showAlert("Loading Error", "Could not load data. Please try again later.", 'error');
        }
    }

    // --- LÓGICA DE BUDGET (API) ---
    async function saveBudget() {
        const newBudget = parseFloat(budgetInput.value) || 0;
        try {
            const response = await fetch(`${API_AUTH_URL}/budget`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: USER_EMAIL, budget: newBudget })
            });
            if (!response.ok) throw new Error("Failed to save budget.");

            budget = newBudget;
            updateBudgetStatus();
            showAlert('Budget saved successfully!', 'success');
        } catch (error) {
            console.error("Error saving budget:", error);
            showAlert('Save Error', error.message || 'Could not save budget.', 'error');
        }
    }

    function updateBudgetStatus() {
      const statusEl = document.getElementById('budget-status');
      const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + (parseFloat(t.amount) || 0), 0);
      if (budget > 0) {
        statusEl.classList.remove('hidden');
        if (totalExpenses <= budget) {
          statusEl.textContent = 'On Track';
          statusEl.className = 'budget-status on-track';
        } else {
          statusEl.textContent = 'Over Budget';
          statusEl.className = 'budget-status over-budget';
        }
      } else {
        statusEl.classList.add('hidden');
      }
    }

    // --- LÓGICA DE TRANSAÇÃO (API) ---
    transactionForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const type = document.getElementById('type').value;
      const category = document.getElementById('category').value;
      const description = document.getElementById('description').value.trim();
      const currency = document.getElementById('currency').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const date = document.getElementById('date').value;

      if (!type || !category || !description || !amount || !date) return;

      const transactionData = { 
            name: USER_EMAIL, // API usa 'name' para o email
            description: description,
            amount: amount,
            type: type,
            category: category,
            date: date,
            currency: currency
        };

        try {
            const response = await fetch(`${API_TRACKERS_URL}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(transactionData)
            });
            if (!response.ok) throw new Error('Failed to add transaction');
            const newTransaction = await response.json();
            transactions.push(newTransaction);
            renderTransactions();
            updateSummary();
            updateBudgetStatus();
            renderChart();
            updateGoalsProgress();
            e.target.reset();
            showAlert('Transaction added successfully!', 'success');

        } catch (error) {
            console.error("Error adding transaction:", error);
            showAlert('Error', 'Could not add transaction.', 'error');
        }
    });

    // Render transactions
    function renderTransactions() {
      const tbody = document.getElementById('transactions-body');
      tbody.innerHTML = '';
      const filterType = document.getElementById('filter-type').value;
      const filterCategory = document.getElementById('filter-category').value;
      
      let filteredTransactions = transactions.filter(t => {
        return (!filterType || t.type === filterType) && (!filterCategory || t.category === filterCategory);
      });

      filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(t => {
        const row = document.createElement('tr');
        // Correção de data (Timezone/Off-by-one)
        const dateParts = (t.date || '').split('-'); 
        const localDate = new Date(dateParts[0], (dateParts[1]||1) - 1, dateParts[2]||1, 12, 0, 0); 
        const formattedDate = isNaN(localDate) ? (t.date || '') : localDate.toLocaleDateString('pt-BR');

        row.innerHTML = `
          <td>${formattedDate}</td>
          <td>${t.description}</td>
          <td>${t.category}</td>
          <td class="${t.type}">${t.type.charAt(0).toUpperCase() + t.type.slice(1)}</td>
          <td>${t.currency || '$'}${(parseFloat(t.amount)||0).toFixed(2)}</td>
          <td><button class="delete-btn" onclick="deleteTransaction(${t.id})"><i class="fas fa-trash"></i></button></td>
        `;
        transactionsBody.appendChild(row);
      });
    }

    // Função para deletar todas as transações (API)
    async function deleteAllTransactions() {
        if (!confirm("Are you sure you want to delete ALL transactions? This action cannot be undone.")) {
            return;
        }

        try {
            const response = await fetch(`${API_TRACKERS_URL}`, {
                method: 'DELETE'
            });
            if (!response.ok) throw new Error('Failed to delete all transactions');

            transactions = [];
            renderTransactions();
            updateSummary();
            updateBudgetStatus();
            renderChart();
            updateGoalsProgress();
            showAlert('All transactions have been deleted!', 'error');

        } catch (error) {
            console.error("Error deleting all transactions:", error);
            showAlert('Error', error.message || 'Could not delete all transactions', 'error');
        }
    }

    // Deletar transação (API)
    async function deleteTransaction(id) {
        if (!confirm("Are you sure you want to delete this transaction?")) {
            return;
        }

        try {
            const response = await fetch(`${API_TRACKERS_URL}/${id}`, {
                method: 'DELETE'
            });
            if (!response.ok) throw new Error('Failed to delete transaction');
            transactions = transactions.filter(t => t.id !== id);
            renderTransactions();
            updateSummary();
            updateBudgetStatus();
            renderChart();
            updateGoalsProgress();
            showAlert('Transaction deleted!', 'error');

        } catch (error) {
            console.error("Error deleting transaction:", error);
            showAlert('Error', error.message || 'Could not delete transaction', 'error');
        }
    }

    // Update summary (Calcula totais baseado na lista 'transactions' local)
    function updateSummary() {
      const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + (parseFloat(t.amount)||0), 0);
      const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + (parseFloat(t.amount)||0), 0);
      const netBalance = totalIncome - totalExpenses;

      document.getElementById('total-income').textContent = `$${totalIncome.toFixed(2)}`;
      document.getElementById('total-expenses').textContent = `$${totalExpenses.toFixed(2)}`;
      document.getElementById('net-balance').textContent = `$${netBalance.toFixed(2)}`;

      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      const monthlyIncome = transactions.filter(t => t.type === 'income' && new Date(t.date).getMonth() === currentMonth && new Date(t.date).getFullYear() === currentYear).reduce((sum, t) => sum + (parseFloat(t.amount)||0), 0);
      const monthlyExpenses = transactions.filter(t => t.type === 'expense' && new Date(t.date).getMonth() === currentMonth && new Date(t.date).getFullYear() === currentYear).reduce((sum, t) => sum + (parseFloat(t.amount)||0), 0);
      document.getElementById('monthly-summary').innerHTML = `
        <strong>Income:</strong> $${monthlyIncome.toFixed(2)}<br>
        <strong>Expenses:</strong> $${monthlyExpenses.toFixed(2)}<br>
        <strong>Balance:</strong> $${(monthlyIncome - monthlyExpenses).toFixed(2)}
      `;
    }

    // Render pie chart for expenses
    function renderChart() {
      const ctx = document.getElementById('expenseChart').getContext('2d');
      const expenseData = transactions.filter(t => t.type === 'expense');
      const categories = {};
      expenseData.forEach(t => {
        categories[t.category] = (categories[t.category] || 0) + (parseFloat(t.amount)||0);
      });
      const labels = Object.keys(categories);
      const data = Object.values(categories);

      if (expenseChart) {
        expenseChart.destroy();
      }

      expenseChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: [
              '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#030e1c'
              }
            },
            datalabels: {
              formatter: (value, ctx) => {
                let sum = 0;
                let dataArr = ctx.chart.data.datasets[0].data;
                dataArr.map(data => { sum += data; });
                let percentage = (value*100 / sum).toFixed(1) + '%';
                return percentage;
              },
              color: '#fff',
              font: {
                weight: 'bold',
                size: 14,
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.label || '';
                  if (label) {
                      label += ': ';
                  }
                  if (context.parsed !== null) {
                      label += '$' + (context.parsed).toFixed(2);
                  }
                  return label;
                }
              }
            }
          }
        }
      });
    }
    
    // Update chart colors on dark mode toggle
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const icon = document.querySelector('#darkModeToggle i');
      if (document.body.classList.contains('dark-mode')) {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
      } else {
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
      }
      if (expenseChart) {
        expenseChart.options.plugins.legend.labels.color = document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#030e1c';
        expenseChart.update();
      }
    }

   // Export to CSV
function exportToCSV() {
  let csvContent = "data:text/csv;charset=utf-8,";
  csvContent += "Date,Description,Category,Type,Amount\n";

  transactions.forEach(t => {
    // Escapa aspas da descrição e a envolve em aspas para preservar vírgulas
    const desc = `"${(t.description || '').replace(/"/g, '""')}"`;
    const date = t.date || '';
    const category = t.category || '';
    const type = t.type || '';
    const amount = `${t.currency || '$'}${(parseFloat(t.amount) || 0).toFixed(2)}`;

    const row = [date, desc, category, type, amount].join(',');
    csvContent += row + "\n";
  });

  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", "transactions.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  showAlert('Transactions exported to CSV!', 'success');
}

    // Show custom alert
    function showAlert(message, type) {
      const alertEl = document.getElementById('custom-alert');
      const cardEl = alertEl.querySelector('.custom-alert-card');
      document.getElementById('alert-message').textContent = message;
      const titleEl = document.getElementById('alert-title');
      cardEl.className = 'custom-alert-card';
      if (type === 'success') {
        cardEl.classList.add('success-border');
        titleEl.textContent = 'Success!';
      } else if (type === 'error') {
        cardEl.classList.add('error-border');
        titleEl.textContent = 'Error';
      } else {
        cardEl.classList.add('notice-border');
        titleEl.textContent = 'Notice';
      }
      alertEl.classList.add('show');
    }

    // Close alert
    function closeAlert() {
      document.getElementById('custom-alert').classList.remove('show');
    }

    // --- LÓGICA DE METAS (Mantida com localStorage) ---
    function setSavingsGoal() {
      const goalInput = document.getElementById('savings-goal');
      savingsGoal = parseFloat(goalInput.value) || 0;
      localStorage.setItem('savingsGoal', savingsGoal);
      updateGoalsProgress();
      showAlert('Savings goal set!', 'success');
    }

    function setDebtGoal() {
      const goalInput = document.getElementById('debt-goal');
      debtGoal = parseFloat(goalInput.value) || 0;
      localStorage.setItem('debtGoal', debtGoal);
      updateGoalsProgress();
      showAlert('Debt goal set!', 'success');
    }

    function setEmergencyGoal() {
      const goalInput = document.getElementById('emergency-goal');
      emergencyGoal = parseFloat(goalInput.value) || 0;
      localStorage.setItem('emergencyGoal', emergencyGoal);
      updateGoalsProgress();
      showAlert('Emergency fund goal set!', 'success');
    }

    function loadGoals() {
      document.getElementById('savings-goal').value = savingsGoal ? savingsGoal.toFixed(2) : '';
      document.getElementById('debt-goal').value = debtGoal ? debtGoal.toFixed(2) : '';
      document.getElementById('emergency-goal').value = emergencyGoal ? emergencyGoal.toFixed(2) : '';
    }

    function updateGoalsProgress() {
      const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + (parseFloat(t.amount)||0), 0);
      const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + (parseFloat(t.amount)||0), 0);
      const netBalance = totalIncome - totalExpenses;

      if (savingsGoal > 0) {
        const progress = Math.min((netBalance / savingsGoal) * 100, 100);
        document.getElementById('savings-progress').style.width = `${progress}%`;
        document.getElementById('savings-status').textContent = `Progress: ${progress.toFixed(1)}%`;
      }

      if (debtGoal > 0) {
        const progress = Math.min((totalExpenses / debtGoal) * 100, 100);
        document.getElementById('debt-progress').style.width = `${progress}%`;
        document.getElementById('debt-status').textContent = `Progress: ${progress.toFixed(1)}%`;
      }

      if (emergencyGoal > 0) {
        const progress = Math.min((netBalance / emergencyGoal) * 100, 100);
        document.getElementById('emergency-progress').style.width = `${progress}%`;
        document.getElementById('emergency-status').textContent = `Progress: ${progress.toFixed(1)}%`;
      }
    }

    // --- LÓGICA DE UI (Menu e Fundo) ---
    function toggleMenu() {
      navLinks.classList.toggle('active');
      document.querySelector('.hamburger').classList.toggle('open');
    }

  </script>

</body>
</html>
